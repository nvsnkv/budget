<div class="duplicates-container">
  <tui-loader [overlay]="true" [showLoader]="isLoading">
    <div class="duplicates-card">
      <div class="header">
        <h2 tuiTitle size="l">Duplicate Operations</h2>
      </div>

      <!-- Filters -->
      <app-criteria-filter
        [initialCriteria]="'o => true'"
        [examples]="criteriaExamples"
        [showExamplesInitially]="false"
        (criteriaSubmitted)="onCriteriaSubmitted($event)"
        (criteriaCleared)="onCriteriaCleared()">
      </app-criteria-filter>

      <!-- Duplicates List -->
      <div class="duplicates-section">
        @if (duplicateGroups.length > 0) {
          <div class="duplicates-summary">
            <h3 tuiTitle size="m">Found {{ duplicateGroups.length }} duplicate groups ({{ getTotalDuplicates() }} operations)</h3>
          </div>

          @for (group of duplicateGroups; track $index; let groupIdx = $index) {
            <div class="duplicate-group">
              <h4>Duplicate Group {{ groupIdx + 1 }} ({{ group.length }} operations)</h4>
              <app-operations-table 
                [operations]="group" 
                [showActions]="true"
                (operationsDeleted)="onDeleteOperations($event)"
                (operationsUpdated)="onUpdateOperations($event)"
                (operationNoteUpdated)="onUpdateOperationNote($event)">
              </app-operations-table>
            </div>
          }
        } @else {
          <div class="empty-state">
            <p>No duplicate operations found with the current criteria.</p>
            <button 
              tuiButton
              type="button"
              appearance="flat"
              size="m"
              (click)="clearFilters()">
              Reset Filters
            </button>
          </div>
        }
      </div>
    </div>
  </tui-loader>
</div>

